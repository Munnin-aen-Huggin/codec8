# Plan 09-06: Analytics + Mobile Optimization

<objective>
Add comprehensive analytics tracking per SPEC and optimize for mobile (60%+ of traffic). Ensure performance targets are met.
</objective>

<execution_context>
@.planning/phases/09-cro-landing-page-rebuild/SPEC.md (Analytics Events, Mobile Optimization, Performance Targets)
@src/lib/server/analytics.ts
@src/routes/+page.svelte
</execution_context>

<context>
**Current State:**
- Basic analytics tracking exists (EVENTS constant)
- Some events already tracked (demo_completed, etc.)
- Mobile responsive but not optimized
- Performance not measured

**SPEC Analytics Events:**
- page_view (with source/medium)
- demo_input_focused
- demo_submitted
- demo_completed (with generation_time)
- demo_limit_reached
- upsell_viewed
- pricing_viewed
- checkout_started (with tier)
- checkout_completed (with tier, revenue)
- exit_intent_shown
- email_captured

**SPEC Performance Targets:**
- LCP < 2.5s
- FID < 100ms
- CLS < 0.1
- Time to interactive < 3s

**Mobile Requirements (60%+ traffic):**
- Headline: 2 lines max
- Input field: Full width
- CTA button: Full width, sticky at bottom
- Locked cards: 2x2 grid or horizontal scroll
- Pricing: Swipeable cards
</context>

<tasks>

## Task 1: Add Missing Analytics Events

Extend analytics tracking to cover all SPEC events.

**Requirements:**
- Add new event constants to EVENTS object
- Track demo_input_focused (on focus)
- Track upsell_viewed (when upsell section enters viewport)
- Track pricing_viewed (when pricing section enters viewport)
- Track exit_intent_shown and email_captured
- Use IntersectionObserver for viewport tracking

**New Events:**
```typescript
DEMO_INPUT_FOCUSED: 'demo_input_focused',
UPSELL_VIEWED: 'upsell_viewed',
PRICING_VIEWED: 'pricing_viewed',
EXIT_INTENT_SHOWN: 'exit_intent_shown',
EMAIL_CAPTURED: 'email_captured',
```

**Files:**
- `src/lib/server/analytics.ts` - Add event constants
- `src/lib/stores/analytics.ts` - Client-side tracking helper

**Acceptance:**
- [ ] All SPEC events have constants
- [ ] Viewport tracking implemented
- [ ] Events fire at correct moments
- [ ] No duplicate event fires

---

## Task 2: Mobile Layout Optimization

Optimize all components for mobile-first design.

**Requirements:**
- Hero: Headline max 2 lines, larger touch targets
- Demo form: Full width input and button, stacked
- Pricing cards: Horizontal scroll or swipeable
- Locked docs: 2-column grid or horizontal scroll
- CTA: Sticky bottom bar on mobile
- Navigation: Hamburger menu or simplified

**Mobile Breakpoints:**
```css
@media (max-width: 768px) { /* Tablet */ }
@media (max-width: 640px) { /* Mobile */ }
```

**Files:** All component files

**Acceptance:**
- [ ] No horizontal scroll on any page
- [ ] Touch targets minimum 44x44px
- [ ] Text readable without zooming
- [ ] Forms usable with keyboard

---

## Task 3: Performance Verification

Measure and optimize performance to meet SPEC targets.

**Requirements:**
- Run Lighthouse audit
- Optimize images (if any)
- Lazy load below-fold content
- Minimize JavaScript bundle
- Verify Core Web Vitals

**Targets:**
- LCP (Largest Contentful Paint) < 2.5s
- FID (First Input Delay) < 100ms
- CLS (Cumulative Layout Shift) < 0.1
- TTI (Time to Interactive) < 3s

**Verification:**
```bash
# Build and preview
npm run build
npm run preview

# Run Lighthouse
# Chrome DevTools > Lighthouse > Mobile
```

**Files:** Various (optimization as needed)

**Acceptance:**
- [ ] Lighthouse mobile score > 90
- [ ] LCP < 2.5s
- [ ] No layout shifts during load
- [ ] Fast time to interactive

</tasks>

<verification>
```bash
# Development testing
npm run dev

# Test on mobile device or Chrome DevTools mobile view
# Verify all interactions work

# Production performance
npm run build
npm run preview
# Run Lighthouse audit in Chrome DevTools

# Analytics verification
# Check Supabase events table for new event types
```
</verification>

<success_criteria>
- [ ] All SPEC analytics events tracked
- [ ] Mobile layout optimized (no horizontal scroll)
- [ ] Touch targets adequate (44x44px minimum)
- [ ] Lighthouse mobile score > 90
- [ ] LCP < 2.5s, CLS < 0.1
- [ ] No TypeScript errors
- [ ] All previous features still work
</success_criteria>

<output>
Updated files:
- `src/lib/server/analytics.ts` - New event constants
- `src/lib/stores/analytics.ts` - Client-side tracking (new)
- All component files - Mobile optimizations

Phase 9 complete. Ready for verification testing.
</output>

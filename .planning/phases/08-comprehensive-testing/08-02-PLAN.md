---
phase: 08-comprehensive-testing
plan: 02
type: tdd
domain: testing
---

<objective>
Unit tests for prompt template builders and analytics utilities.

Purpose: Test prompt generation functions produce expected output structure and analytics utilities work correctly.
Output: Complete test coverage for prompts.ts and analytics utilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@src/lib/utils/prompts.ts
@src/lib/utils/analytics.ts
@src/lib/stores/analytics.ts
@src/lib/utils/parser.ts (RepoContext type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prompt Builder Unit Tests</name>
  <files>src/lib/utils/prompts.test.ts</files>
  <action>
Create tests for prompt template builders:

**buildReadmePrompt tests:**
- Includes repo name in output
- Includes description or fallback text
- Includes package.json content when provided
- Includes file tree
- Includes key files with proper formatting
- Contains all required README sections (Title, Description, Features, etc.)

**buildApiPrompt tests:**
- Includes route files with proper code blocks
- Contains endpoint documentation instructions
- Handles empty route files gracefully

**buildArchitecturePrompt tests:**
- Contains Mermaid diagram instructions
- Includes dependencies from package.json
- Contains architecture section keywords

**buildSetupPrompt tests:**
- Includes environment variables section
- Contains setup instructions
- Handles missing envExample gracefully

**promptBuilders mapping tests:**
- Maps 'readme' to buildReadmePrompt
- Maps 'api' to buildApiPrompt
- Maps 'architecture' to buildArchitecturePrompt
- Maps 'setup' to buildSetupPrompt
- All four doc types present

Create mock RepoContext objects for testing.
  </action>
  <verify>npm run test:unit -- src/lib/utils/prompts.test.ts passes</verify>
  <done>15+ tests covering all prompt builders</done>
</task>

<task type="auto">
  <name>Task 2: Analytics Utilities Tests</name>
  <files>src/lib/utils/analytics.test.ts, src/lib/stores/analytics.test.ts</files>
  <action>
Create tests for analytics utilities:

**Client-side analytics store (src/lib/stores/analytics.test.ts):**
- Generates anonymous ID on first access
- Persists ID across store accesses (mock localStorage)
- ID follows expected format (if any)

**Analytics utility (src/lib/utils/analytics.ts) if present:**
- Test any event tracking helper functions
- Test any data formatting utilities

Use vitest mocking for localStorage/browser APIs.
  </action>
  <verify>npm run test:unit -- src/lib/stores/analytics.test.ts passes</verify>
  <done>8+ tests for analytics utilities</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All tests pass with `npm run test:unit`
- [ ] No TypeScript errors
- [ ] Tests use mock data, no external calls
</verification>

<success_criteria>
- All tasks completed
- 23+ new unit tests passing
- Prompt builders tested for structure
- Analytics utilities tested
</success_criteria>

<output>
After completion, create `.planning/phases/08-comprehensive-testing/08-02-SUMMARY.md`
</output>
